<section class="blog-grid-section section-padding">
  <div class="container-fluid">
    <h2 class="section-title">Latest News & Articles</h2>

    <!-- ============================================ -->
    <!-- LOADING STATE - Using PrimeNG Skeleton -->
    <!-- ============================================ -->
    @if (isLoading()) {
    <div class="row">
      <!-- Sidebar Skeleton -->
      <div class="col-lg-3 col-md-4 mb-4">
        <p-card header="Categories">
          @for (i of [1, 2, 3, 4]; track i) {
          <p-skeleton height="3rem" styleClass="mb-2" />
          }
        </p-card>
      </div>
      <!-- Content Skeleton -->
      <div class="col-lg-9 col-md-8">
        <div class="blog-grid">
          @for (i of [1, 2, 3, 4, 5, 6]; track i) {
          <div class="blog-card-skeleton">
            <p-skeleton height="200px" styleClass="mb-3" />
            <p-skeleton height="1.5rem" width="40%" styleClass="mb-2" />
            <p-skeleton height="1.2rem" styleClass="mb-2" />
            <p-skeleton height="1rem" width="80%" />
          </div>
          }
        </div>
      </div>
    </div>
    }

    <!-- ============================================ -->
    <!-- ERROR STATE -->
    <!-- ============================================ -->
    @if (hasError()) {
    <div class="row justify-content-center">
      <div class="col-md-6 text-center py-5">
        <i class="pi pi-exclamation-triangle text-6xl text-red-500 mb-4"></i>
        <h4 class="mb-3">Failed to Load News</h4>
        <p class="text-muted mb-4">{{ error() }}</p>
        <p-button
          label="Try Again"
          icon="pi pi-refresh"
          (onClick)="retry()"
          severity="danger"
        />
      </div>
    </div>
    }

    <!-- ============================================ -->
    <!-- SUCCESS STATE -->
    <!-- ============================================ -->
    @if (isSuccess()) {
    <div class="row">
      <!-- Sidebar - Categories -->
      <div class="col-lg-3 col-md-4 mb-4">
        <div class="category-sidebar card-custom">
          <h4 class="sidebar-title">
            <i class="pi pi-folder mr-2"></i>
            Categories
          </h4>
          <ul class="category-list">
            <!-- All Items -->
            <li>
              <button
                type="button"
                class="category-btn"
                [class.active]="isCategorySelected('all')"
                (click)="onCategoryChange('all')"
              >
                <i class="pi pi-list mr-2"></i>
                All Items
                <p-tag
                  [value]="totalNewsCount().toString()"
                  [rounded]="true"
                  styleClass="ml-auto"
                />
              </button>
            </li>
            <!-- Category Items -->
            @for (category of categories(); track category.id) {
            <li>
              <button
                type="button"
                class="category-btn"
                [class.active]="isCategorySelected(category.id)"
                (click)="onCategoryChange(category.id)"
              >
                <i class="pi pi-folder mr-2"></i>
                {{ category.name }}
                <p-tag
                  [value]="getCategoryCount(category.id).toString()"
                  [rounded]="true"
                  styleClass="ml-auto"
                />
              </button>
            </li>
            }
          </ul>
        </div>
      </div>

      <!-- Main Content -->
      <div class="col-lg-9 col-md-8">
        <!-- Results Header -->
        <header class="results-header mb-4">
          <h3 class="results-title">{{ selectedCategoryName() }}</h3>
          <p class="results-count">
            Showing {{ paginatedNews().length }} of {{ totalRecords() }} items
          </p>
        </header>

        <!-- News Grid -->
        @if (hasNews()) {
        <div class="blog-grid">
          @for (item of paginatedNews(); track item.id) {
          <article class="blog-card hover-lift">
            <!-- Image Container -->
            <div class="blog-image-container">
              <img
                [src]="getFeaturedImage(item)"
                [alt]="item.title"
                class="blog-img"
                loading="lazy"
              />
              <!-- Categories Badges -->
              @if (hasCategories(item)) {
              <div class="blog-categories-badges">
                @for (cat of getItemCategories(item); track cat.id) {

                <p-tag
                  [value]="cat.name"
                  severity="info"
                  icon="pi pi-bookmark"
                  styleClass="mr-1 mb-1"
                />
                }
              </div>
              }
            </div>

            <!-- Content -->
            <div class="blog-content">
              <!-- Meta -->
              <div class="blog-meta">
                <p-tag
                  [value]="formatDate(item.createdDate)"
                  icon="pi pi-calendar"
                  severity="secondary"
                  styleClass="mr-2"
                />
                @if (item.status) {
                <p-tag
                  [value]="item.status"
                  [severity]="getStatusSeverity(item.status)"
                />
                }
              </div>

              <!-- Title -->
              <h3 class="blog-title">
                <a [routerLink]="['/news', item.id]">{{ item.title }}</a>
              </h3>

              <!-- Excerpt -->
              <p class="blog-excerpt">{{ getExcerpt(item.content) }}</p>

              <!-- Tags -->
              @if (hasTags(item)) {
              <div class="blog-tags">
                @for (tag of getVisibleTags(item); track tag.id) {
                <p-tag
                  [value]="tag.name"
                  severity="info"
                  [rounded]="true"
                  styleClass="mr-1 mb-1"
                />
                }
              </div>
              }

              <!-- Footer -->
              <div class="blog-footer">
                <p-button
                  label="Read More"
                  icon="pi pi-arrow-right"
                  iconPos="right"
                  [outlined]="true"
                  [routerLink]="['/news', item.id]"
                  styleClass="p-button-sm"
                />
              </div>
            </div>
          </article>
          }
        </div>

        <!-- Pagination (PrimeNG Paginator) -->
        @if (showPagination()) {
        <div class="pagination-wrapper mt-4">
          <p-paginator
            [first]="first()"
            [rows]="rows()"
            [totalRecords]="totalRecords()"
            [showCurrentPageReport]="true"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} articles"
            (onPageChange)="onPageChange($event)"
            styleClass="justify-content-center"
          />
        </div>
        } } @else {
        <!-- No Results -->
        <div class="no-results text-center py-5">
          <i class="pi pi-search text-6xl text-gray-400 mb-4"></i>
          <h4 class="mb-3">No items found</h4>
          <p class="text-muted mb-4">
            Try selecting a different category or check back later for new
            content.
          </p>
          <p-button
            label="View All News"
            icon="pi pi-list"
            (onClick)="onCategoryChange('all')"
            [outlined]="true"
          />
        </div>
        }
      </div>
    </div>
    }
  </div>
</section>
