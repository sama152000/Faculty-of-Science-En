<section class="units-section">
  <!-- Loading State -->
  @if (loading()) {
  <div class="loading-container">
    <div class="row">
      <div class="col-lg-3 col-md-4 mb-4">
        <p-card>
          <p-skeleton height="2rem" width="60%" styleClass="mb-3" />
          @for (i of [1, 2, 3, 4]; track i) {
          <p-skeleton height="4rem" styleClass="mb-2" />
          }
        </p-card>
      </div>
      <div class="col-lg-9 col-md-8">
        <p-card>
          <p-skeleton height="6rem" styleClass="mb-4" />
          <p-skeleton height="3rem" styleClass="mb-2" />
          <p-skeleton height="10rem" />
        </p-card>
      </div>
    </div>
  </div>
  }

  <!-- Error State -->
  @if (error()) {
  <div class="error-container text-center py-5">
    <i class="pi pi-exclamation-triangle text-6xl text-danger mb-4"></i>
    <h4 class="mb-3">{{ error() }}</h4>
    <p-button
      label="Try Again"
      icon="pi pi-refresh"
      (onClick)="retry()"
      severity="danger"
    />
  </div>
  }

  <!-- Success State -->
  @if (!loading() && !error() && hasData()) {
  <div class="row">
    <!-- Sidebar -->
    <div class="col-lg-3 col-md-4 mb-4">
      <div class="items-sidebar card-custom">
        <h4 class="sidebar-title">
          <i class="fas fa-building me-2"></i>
          Faculty Units
        </h4>

        <ul class="items-list">
          @for (unit of units(); track unit.id) {
          <li>
            <button
              class="item-btn"
              [class.active]="isUnitSelected(unit.id)"
              (click)="selectUnit(unit)"
            >
              <div class="item-icon">
                @if (getUnitImage(unit)) {
                <img
                  [src]="getUnitImage(unit)"
                  [alt]="unit.unitTitleEn || unit.unitTitle"
                  class="unit-thumb"
                />
                } @else {
                <i class="fas fa-building"></i>
                }
              </div>
              <div class="item-info">
                <h6 class="item-name">
                  {{ unit.unitTitleEn || unit.unitTitle }}
                </h6>
              </div>
            </button>
          </li>
          }
        </ul>
      </div>
    </div>

    <!-- Content -->
    <div class="col-lg-9 col-md-8">
      @if (selectedUnit(); as unit) {
      <div class="item-content">
        <!-- Unit Header -->
        <div class="item-header card-custom mb-4">
          <div class="header-content">
            <div class="item-icon-large">
              @if (getUnitImage(unit)) {
              <img
                [src]="getUnitImage(unit)"
                [alt]="unit.unitTitleEn || unit.unitTitle"
                class="unit-image"
              />
              } @else {
              <i class="fas fa-building"></i>
              }
            </div>
            <div class="header-info">
              <h1 class="item-title">
                {{ unit.unitTitleEn || unit.unitTitle }}
              </h1>

              <div class="item-stats">
                @if (leader()) {
                <div class="stat-item">
                  <i class="fas fa-user-tie"></i>
                  <span>{{ leader()?.memberName }}</span>
                </div>
                }
              </div>
            </div>
          </div>
        </div>

        <!-- Section Navigation -->
        <div class="section-nav card-custom mb-4">
          <div class="nav-buttons">
            <button
              class="nav-btn"
              [class.active]="isActiveSection('overview')"
              (click)="setActiveSection('overview')"
            >
              <i class="fas fa-info-circle me-2"></i>
              Overview
            </button>
            <button
              class="nav-btn"
              [class.active]="isActiveSection('objectives')"
              (click)="setActiveSection('objectives')"
            >
              <i class="fas fa-bullseye me-2"></i>
              Objectives
            </button>
            @if (hasDetails()) {
            <button
              class="nav-btn"
              [class.active]="isActiveSection('details')"
              (click)="setActiveSection('details')"
            >
              <i class="fas fa-list me-2"></i>
              Details
            </button>
            } @if (hasMembers()) {
            <button
              class="nav-btn"
              [class.active]="isActiveSection('team')"
              (click)="setActiveSection('team')"
            >
              <i class="fas fa-users me-2"></i>
              Team
            </button>
            }
          </div>
        </div>

        <!-- Section Content -->
        <div class="section-content card-custom">
          <!-- Overview Section -->
          @if (isActiveSection('overview')) {
          <div class="content-section">
            <div class="section-header">
              <h3 class="section-title-left">
                <i class="fas fa-info-circle text-primary-custom me-3"></i>
                Unit Overview
              </h3>
            </div>

            <div class="content-body">
              <p class="lead" [innerHTML]="unit.content"></p>

              <div class="row mt-4">
                @if (unit.mission) {
                <div class="col-md-6 mb-3">
                  <div class="info-card">
                    <h5 class="text-primary-custom">
                      <i class="fas fa-bullhorn me-2"></i>
                      Mission
                    </h5>
                    <p [innerHTML]="unit.mission"></p>
                  </div>
                </div>
                } @if (unit.vision) {
                <div class="col-md-6 mb-3">
                  <div class="info-card">
                    <h5 class="text-primary-custom">
                      <i class="fas fa-eye me-2"></i>
                      Vision
                    </h5>
                    <p [innerHTML]="unit.vision"></p>
                  </div>
                </div>
                } @if (unit.history) {
                <div class="col-12 mb-3">
                  <div class="info-card">
                    <h5 class="text-primary-custom">
                      <i class="fas fa-history me-2"></i>
                      History
                    </h5>
                    <p [innerHTML]="unit.history"></p>
                  </div>
                </div>
                }
              </div>
            </div>
          </div>
          }

          <!-- Objectives Section -->
          @if (isActiveSection('objectives')) {
          <div class="content-section">
            <div class="section-header">
              <h3 class="section-title-left">
                <i class="fas fa-bullseye text-primary-custom me-3"></i>
                Objectives
              </h3>
            </div>

            <div class="content-body">
              @if (unit.goals && unit.goals.length > 0) {
              <div class="objectives-grid">
                @for (goal of unit.goals; track goal.id; let i = $index) {
                <div class="objective-item">
                  <div class="objective-number">{{ i + 1 }}</div>
                  <div class="objective-content">
                    <p>{{ goal.goalName }}</p>
                  </div>
                </div>
                }
              </div>
              } @else {
              <p class="text-muted">No objectives available.</p>
              }
            </div>
          </div>
          }

          <!-- Details Section -->
          @if (isActiveSection('details')) {
          <div class="content-section">
            <div class="section-header">
              <h3 class="section-title-left">
                <i class="fas fa-list text-primary-custom me-3"></i>
                Unit Details
              </h3>
            </div>

            <div class="content-body">
              @if (detailsLoading()) {
              <div class="text-center py-4">
                <p-skeleton height="5rem" styleClass="mb-2" />
                <p-skeleton height="5rem" />
              </div>
              } @else if (hasDetails()) {
              <div class="details-list">
                @for (detail of unitDetails(); track detail.id) {
                <div class="detail-item">
                  <h5 class="detail-title">{{ detail.title }}</h5>
                  @if (detail.unitPlace) {
                  <p class="detail-place">
                    <i class="fas fa-map-marker-alt me-2"></i>
                    {{ detail.unitPlace }}
                  </p>
                  }
                  <div
                    class="detail-content"
                    [innerHTML]="detail.content"
                  ></div>
                </div>
                }
              </div>
              } @else {
              <p class="text-muted">No details available.</p>
              }
            </div>
          </div>
          }

          <!-- Team Section -->
          @if (isActiveSection('team')) {
          <div class="content-section">
            <div class="section-header">
              <h3 class="section-title-left">
                <i class="fas fa-users text-primary-custom me-3"></i>
                Unit Team
              </h3>
            </div>

            <div class="content-body">
              @if (hasMembers()) {
              <div class="team-grid">
                @for (member of unitMembers(); track member.id) {
                <div class="team-card" [class.leader]="member.isLeader">
                  <div class="team-avatar">
                    <p-avatar
                      [label]="member.memberName.charAt(0)"
                      size="large"
                      shape="circle"
                    />
                  </div>
                  <div class="team-info">
                    <h6 class="team-name">{{ member.memberName }}</h6>
                    @if (member.isLeader) {
                    <p-tag value="Leader" severity="success" />
                    }
                  </div>
                </div>
                }
              </div>
              } @else {
              <p class="text-muted">No team members available.</p>
              }
            </div>
          </div>
          }
        </div>
      </div>
      } @else {
      <!-- No Unit Selected -->
      <div class="no-selection text-center py-5">
        <i class="fas fa-building fa-3x text-muted mb-3"></i>
        <h4>Select a Unit</h4>
        <p class="text-muted">
          Choose a unit from the sidebar to view detailed information.
        </p>
      </div>
      }
    </div>
  </div>
  }

  <!-- Empty State -->
  @if (!loading() && !error() && !hasData()) {
  <div class="empty-state text-center py-5">
    <i class="fas fa-building fa-3x text-muted mb-3"></i>
    <h4>No Units Available</h4>
    <p class="text-muted">Units will be added soon.</p>
  </div>
  }
</section>
